const API_KEY="aad3fab1607b552befd9a2ac37e556af",BASE_URL="https://api.themoviedb.org/3",IMG_BASE_URL="https://image.tmdb.org/t/p/w500";async function fetchDetails(e,t){showLoading(),hideError();try{let a=await fetch(`${BASE_URL}/${t}/${e}?api_key=${API_KEY}&append_to_response=videos`);if(!a.ok)throw Error("Network response was not ok "+a.statusText);displayDetails(await a.json(),t)}catch(e){console.error("Error:",e),showError("Failed to fetch details. Please try again later.")}finally{hideLoading()}}function displayDetails(e,t){let a=document.getElementById("detail-poster"),n=document.getElementById("detail-title"),o=document.getElementById("detail-meta"),i=document.getElementById("detail-overview"),r=document.getElementById("watch-trailer-btn"),d=document.getElementById("watch-trailer-btn2"),l=document.getElementById("watch-trailer-btn3"),s=document.getElementById("watch-trailer-btn4"),c=document.getElementById("watch-trailer-btn5"),m=document.getElementById("watch-trailer-btn6"),h=(e.backdrop_path&&e.backdrop_path,e.poster_path?`${IMG_BASE_URL}${e.poster_path}`:""),p=new Date(e.release_date||e.first_air_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});document.title=`${e.title||e.name} - Stream Now on JioStream`,a.src=h,a.alt=e.title||e.name,n.textContent=e.title||e.name,o.innerHTML=`\n        <span>${p}</span> | \n        <span>${"movie"===t?`${e.runtime} min`:`${e.episode_run_time[0]} min/episode`}</span> | \n        <span>${e.genres.map((e=>e.name)).join(", ")}</span>`,i.textContent=e.overview;[r,d,l,s,c,m].forEach(((a,n)=>{a.style.display="block",a.onclick=()=>toggleTrailer(t,e.id,n+1),3===n?(a.classList.add("active"),toggleTrailer(t,e.id,n+1)):a.classList.remove("active")}))}function toggleTrailer(e,t,a){[document.getElementById("trailer-container"),document.getElementById("trailer-container2"),document.getElementById("trailer-container3"),document.getElementById("trailer-container4"),document.getElementById("trailer-container5"),document.getElementById("trailer-container6")].forEach(((n,o)=>{if(o+1===a){let o;switch(a){case 1:o="movie"===e?`https://vidsrc.dev/embed/movie/${t}`:`https://vidsrc.dev/embed/tv/${t}/1/1`;break;case 2:o=`https://hnembed.cc/embed/${e}/${t}`;break;case 3:o=`https://multiembed.mov/?video_id=${t}&tmdb=1${"tv"===e?"&s=1&e=1":""}`;break;case 4:o="movie"===e?`https://vidlink.pro/movie/${t}`:`https://vidlink.pro/tv/${t}/1/1`;break;case 5:o="movie"===e?`https://embed.su/embed/movie/${t}`:`https://embed.su/embed/tv/${t}/1/1`;break;case 6:o="movie"===e?`https://www.2embed.cc/embed/${t}`:`https://www.2embed.cc/embedtvfull/${t}`}n.innerHTML=`<iframe src="${o}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`,n.classList.add("active")}else n.classList.remove("active"),n.innerHTML=""}))}const buttons=document.querySelectorAll(".watch-trailer-btn");async function fetchRelatedContent(e,t){try{let a=await fetch(`${BASE_URL}/${t}/${e}/recommendations?api_key=${API_KEY}`);if(!a.ok)throw Error("Network response was not ok "+a.statusText);displayRelatedContent((await a.json()).results.slice(0,16),t)}catch(e){console.error("Error:",e),showError("Failed to fetch related content. Please try again later.")}}function displayRelatedContent(e,t){let a=document.getElementById("related-grid");a.innerHTML="",e.forEach((e=>{let n=document.createElement("div");n.className="movie-card";let o=e.poster_path?`${IMG_BASE_URL}${e.poster_path}`:"",i=new Date(e.release_date||e.first_air_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),r=Math.round(10*e.vote_average);n.innerHTML=`\n          <img class="movie-poster" src="${o}" alt="${e.title||e.name}" loading="lazy">\n          <div class="movie-info">\n            <h2 class="movie-title">${e.title||e.name}</h2>\n            <p class="movie-release-date">${i}</p>\n            <div class="movie-overview">${e.overview}</div>\n          </div>\n          <div class="movie-rating">${r}%</div>\n        `,n.addEventListener("click",(()=>{window.location.href=`detail.html?id=${e.id}&type=${t}`})),a.appendChild(n)}))}function showLoading(){document.getElementById("loadingIndicator").style.display="block"}function hideLoading(){document.getElementById("loadingIndicator").style.display="none"}function showError(e){let t=document.getElementById("errorMessage");t.textContent=e,t.style.display="block"}function hideError(){document.getElementById("errorMessage").style.display="none"}buttons.forEach((e=>{e.addEventListener("click",(()=>{buttons.forEach((e=>e.classList.remove("active"))),e.classList.add("active")}))})),document.addEventListener("DOMContentLoaded",(()=>{let e=new URLSearchParams(window.location.search),t=e.get("id"),a=e.get("type");t&&a?(fetchDetails(t,a),fetchRelatedContent(t,a)):showError("Invalid URL parameters. Please go back to the home page and try again.")}));