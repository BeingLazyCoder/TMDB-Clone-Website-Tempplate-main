const API_KEY="aad3fab1607b552befd9a2ac37e556af",BASE_URL="https://api.themoviedb.org/3",IMG_BASE_URL="https://image.tmdb.org/t/p/w500";async function fetchDetails(e,t){showLoading(),hideError();try{let n=await fetch(`${BASE_URL}/${t}/${e}?api_key=${API_KEY}&append_to_response=videos`);if(!n.ok)throw Error("Network response was not ok "+n.statusText);displayDetails(await n.json(),t)}catch(e){console.error("Error:",e),showError("")}finally{hideLoading()}}function displayDetails(e,t){let n=document.getElementById("detail-poster"),a=document.getElementById("detail-title"),i=document.getElementById("detail-meta"),o=document.getElementById("detail-overview"),r=document.getElementById("watch-trailer-btn"),d=document.getElementById("watch-trailer-btn2"),l=document.getElementById("watch-trailer-btn3"),s=document.getElementById("watch-trailer-btn4"),c=document.getElementById("watch-trailer-btn5"),m=document.getElementById("watch-trailer-btn6"),p=e.poster_path?`${IMG_BASE_URL}${e.poster_path}`:"",h=new Date(e.release_date||e.first_air_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});document.title=`${e.title||e.name} - Stream Now on JioStream`,n.src=p,n.alt=e.title||e.name,a.textContent=e.title||e.name,i.innerHTML=`\n        <span>${h}</span> | \n        <span>${"movie"===t?`${e.runtime} min`:`${e.episode_run_time[0]} min/episode`}</span> | \n        <span>${e.genres.map((e=>e.name)).join(", ")}</span>`,o.textContent=e.overview;[r,d,l,s,c,m].forEach(((n,a)=>{n.style.display="block",n.onclick=()=>toggleTrailer(t,e.id,a+1),0===a?(n.classList.add("active"),toggleTrailer(t,e.id,a+1)):n.classList.remove("active")}))}function toggleTrailer(e,t,n){[document.getElementById("trailer-container"),document.getElementById("trailer-container2"),document.getElementById("trailer-container3"),document.getElementById("trailer-container4"),document.getElementById("trailer-container5"),document.getElementById("trailer-container6")].forEach(((a,i)=>{if(i+1===n){let i;switch(n){case 1:i="movie"===e?`https://vidsrc.dev/embed/movie/${t}`:`https://vidsrc.dev/embed/tv/${t}/1/1`;break;case 2:i=`https://hnembed.cc/embed/${e}/${t}`;break;case 3:i=`https://multiembed.mov/?video_id=${t}&tmdb=1${"tv"===e?"&s=1&e=1":""}`;break;case 4:i="movie"===e?`https://vidlink.pro/movie/${t}`:`https://vidlink.pro/tv/${t}/1/1`;break;case 5:i="movie"===e?`https://embed.su/embed/movie/${t}`:`https://embed.su/embed/tv/${t}/1/1`;break;case 6:i="movie"===e?`https://www.2embed.cc/embed/${t}`:`https://www.2embed.cc/embedtvfull/${t}`}a.innerHTML=`<iframe src="${i}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`,a.classList.add("active")}else a.classList.remove("active"),a.innerHTML=""}))}const buttons=document.querySelectorAll(".watch-trailer-btn");async function fetchRelatedContent(e,t){try{let n=await fetch(`${BASE_URL}/${t}/${e}/recommendations?api_key=${API_KEY}`);if(!n.ok)throw Error("Network response was not ok "+n.statusText);displayRelatedContent((await n.json()).results.slice(0,16),t)}catch(e){console.error("Error:",e),showError("Failed to fetch related content. Please try again later.")}}function displayRelatedContent(e,t){let n=document.getElementById("related-grid");n.innerHTML="",e.forEach((e=>{let a=document.createElement("div");a.className="movie-container";let i=document.createElement("div");i.className="movie-card";let o=document.createElement("div");o.className="movie-poster-container";let r=document.createElement("div");r.className="info-card";let d=e.poster_path?`${IMG_BASE_URL}${e.poster_path}`:"",l=new Date(e.release_date||e.first_air_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),s=e.vote_average.toFixed(1);fetch(`https://api.themoviedb.org/3/movie/${e.id}?api_key=${API_KEY}`).then((e=>e.json())).then((c=>{const m=c.runtime;o.innerHTML=`\n                  <img class="movie-poster" src="${d}" alt="${e.title||e.name}" loading="lazy">\n                  <div class="movie-rating">${s}</div>\n              `,r.innerHTML=`\n                  <h2 class="movie-title">${e.title||e.name}</h2>\n                   <div class="movie-release-date-runtime">\n                  <p class="movie-release-date">${l}&nbsp;</p> \n                  <p class="movie-runtime">&nbsp;${m}min&nbsp;</p></div> \n                  <div class="movie-overview">${e.overview}</div>\n              `,i.addEventListener("click",(()=>{window.location.href=`detail.html?id=${e.id}&type=${t}`})),i.appendChild(o),window.innerWidth<=768?(i.appendChild(r),n.appendChild(i)):(a.appendChild(i),a.appendChild(r),n.appendChild(a))})).catch((e=>console.error("Error:",e)))}))}function showLoading(){document.getElementById("loadingIndicator").style.display="block"}function hideLoading(){document.getElementById("loadingIndicator").style.display="none"}function showError(e){let t=document.getElementById("errorMessage");t.textContent=e,t.style.display="block"}function hideError(){document.getElementById("errorMessage").style.display="none"}buttons.forEach((e=>{e.addEventListener("click",(()=>{buttons.forEach((e=>e.classList.remove("active"))),e.classList.add("active")}))})),document.addEventListener("DOMContentLoaded",(()=>{let e=new URLSearchParams(window.location.search),t=e.get("id"),n=e.get("type");t&&n?(fetchDetails(t,n),fetchRelatedContent(t,n)):showError("Invalid URL parameters. Please go back to the home page and try again.")}));